<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ù‡Ø¬ â€” Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {font-family: 'Cairo', sans-serif; background: #f5f7fa; margin: 0; padding: 0;}
    .wrap {max-width: 1200px; margin: auto; padding: 20px;}
    .hero {text-align: center; margin-bottom: 20px; background: #1f2d3d; color: white; padding: 20px; border-radius: 12px;}
    .hero img.header-img {max-width: 100%; border-radius: 12px; margin-bottom: 10px;}
    .title {font-weight: 800; font-size: 24px;}
    .subtitle {opacity: 0.85; font-size: 14px;}
    .info-bar, .footer-bar {display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-top: 10px;}
    .info-item, .footer-item {background: #fff; padding: 8px 14px; border-radius: 10px; border: 1px solid #ddd; display: flex; align-items: center; gap: 6px; font-weight: 700;}

    .toolbar {display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; align-items: center; margin: 18px 0;}
    .group {display: flex; gap: 8px; align-items: center;}
    .btn {cursor: pointer; border:1px solid #ddd; background:#fff; border-radius:10px; padding:8px 12px; font-weight:700}
    .btn:hover {box-shadow:0 0 0 3px rgba(46,126,247,.25)}
    button {user-select:none}

    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    @media(max-width:1100px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media(max-width:800px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:520px){.grid{grid-template-columns:1fr}}

    .card {background: #fff; border: 1px solid #ddd; border-radius: 12px; overflow: hidden;}
    .card-header {display: flex; justify-content: center; align-items: center; padding: 12px 14px; background: #f8fbff; border-bottom:1px solid #e5e7eb}
    .badge {background: #eef2ff; color:#1e3a8a; padding: 6px 10px; border-radius: 10px; font-weight: 800;}
    .status {display:none}
    .card-body {padding: 12px 14px;}

    .date-line{display:flex;gap:10px;justify-content:center;align-items:center;font-size:12px;color:#1d4ed8;margin:6px 0 10px}
    .date-chip{padding:2px 6px;border-radius:6px;background:#eff6ff;border:1px solid #dbeafe;text-decoration:underline;white-space:nowrap}

    .drawer summary{cursor:pointer;font-weight:800;padding:8px 10px;background:#f7fafc;border:1px dashed #d9e3f3;border-radius:10px}
    .drawer[open] summary{border-style:solid}
    .drawer-body{margin-top:10px;display:flex;flex-direction:column;gap:8px}

    .day{display:flex;align-items:center;gap:8px;border:1px solid #e5e7eb;border-radius:10px;padding:6px 8px;background:#fff}
    .day label{min-width:70px;color:#0f172a;font-weight:800}
    .day input{flex:1;padding:8px 10px;border:1px solid #e5e7eb;border-radius:8px}
    .day.is-holiday input{background:#f0fdf4;border-color:#bbf7d0}
    .chip-delete{background:#fff1f2;color:#9f1239;border:1px solid #ffd5da;border-radius:10px;padding:6px 8px;cursor:pointer;font-size:12px}

    .tiny{font-size:12px;color:#666;margin-bottom:8px}

    .tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid transparent}
    .chip-holiday{background:#e9fbea;color:#166534;border-color:#cdeccd}
    .chip-break{background:#fff7d6;color:#7c4a03;border-color:#ffe7a8}
    .chip-notice{background:#ffe4e6;color:#9f1239;border-color:#ffd5da}

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø£Ø­Ø¯Ø§Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„ÙŠÙˆÙ… */
    .pill{display:inline-block;padding:2px 6px;border-radius:999px;font-size:11px;font-weight:800;white-space:nowrap}
    .pill-success{background:#e8f7ec;color:#166534;border:1px solid #cfead6}
    .pill-warn{background:#fff7d6;color:#7c4a03;border:1px solid #ffe7a8}
    .pill-alert{background:#ffe4e6;color:#9f1239;border:1px solid #ffd5da}
    .day .pill{margin-inline-start:auto}

    /* Ù…Ù„Ø®Øµ Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© */
    .break-summary{display:none;margin-top:6px;padding:6px 8px;border:1px dashed #ffe7a8;background:#fff7d6;border-radius:10px}
    .break-summary .row{display:flex;align-items:center;gap:8px;margin:2px 0;font-weight:800;color:#7c4a03}
    .break-summary .row .small{font-size:11px;opacity:.9}
    .break-summary .date-chip{background:#fff; border-color:#ffe7a8}
    

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø£Ø­Ø¯Ø§Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„ÙŠÙˆÙ… */
    .pill{display:inline-block;padding:2px 6px;border-radius:999px;font-size:11px;font-weight:800;white-space:nowrap}
    .pill-success{background:#e8f7ec;color:#166534;border:1px solid #cfead6}
    .pill-warn{background:#fff7d6;color:#7c4a03;border:1px solid #ffe7a8}
    .pill-alert{background:#ffe4e6;color:#9f1239;border:1px solid #ffd5da}
    .day .pill{margin-inline-start:auto}

    .print-value{display:none}

    /* ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· ÙˆÙ‚Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
    .print-header{display:none;text-align:center;font-weight:800;margin:6px 0}


    /* Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¶ØºÙˆØ·Ø©: 6 Ø¬Ø¯Ø§ÙˆÙ„ ÙÙŠ Ø§Ù„ØµÙØŒ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø© Ø£ÙÙ‚ÙŠØ© */
    @media print{
      :root{ --gap:3mm; --card-h:40mm; }
      html{font-size:9.6px}
      body{background:#fff;-webkit-print-color-adjust:exact;print-color-adjust:exact}
      .hero,.toolbar,.info-bar,.footer-bar{display:none!important}
      .print-header{display:block;font-size:12px;margin:0 0 2mm;text-align:center}
      .wrap{max-width:100%;padding:0}
      .grid{display:grid;grid-template-columns:repeat(5, 1fr)!important;gap:var(--gap)}
      .card{box-shadow:none;border:1px solid #cfcfcf;border-radius:8px;height:var(--card-h);break-inside:avoid;page-break-inside:avoid;background:#fff}
      .card-holiday{background:#eaf7ee}
      .card-break{background:#fff7d6}
      .card-notice{background:#fde2e7}
      .card-header{padding:2mm}
      .badge{padding:1.6mm 2.4mm;font-size:10px}
      .card-body{padding:2mm}
      .date-line{margin:1mm 0 1.2mm;font-size:8.4px;gap:2mm}
      .tags,.actions,.chip-delete,.drawer summary{display:none!important}
      .drawer-body{gap:1.4mm}
      .day{padding:0;border:0;background:transparent;display:grid;grid-template-columns:38px 1fr;align-items:center}
      .day label{min-width:unset;font-size:8.2px}
      .day input{display:none}
      .print-value{display:block;min-height:10px;padding:1mm 0;border-bottom:1px dashed #9ca3af;white-space:pre-wrap}
      .week-break .drawer-body{display:none!important}
      .week-break .break-summary{display:block!important}
      .site-footer{position:fixed;bottom:4mm;left:0;right:0;margin:0;font-size:9.6px}
    }
    @page{size:A4 landscape;margin:6mm}

    .site-footer{text-align:center;color:#6b7280;font-weight:700;margin:16px auto 24px}
    @media print{.site-footer{position:fixed;bottom:4mm;left:0;right:0;margin:0;font-size:10px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <img class="header-img" src="https://c.top4top.io/p_3510xq5a01.png" alt="ØµÙˆØ±Ø© Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©">
      <div class="title">Ù…Ù„ØªÙ‚Ù‰ Ù…Ø¹Ù„Ù…ÙŠ ÙˆÙ…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª â€” ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù†Ù‡Ø¬</div>
      <div class="subtitle">ÙŠØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ â€¢ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¹Ù„Ù‰ A4</div>
      <div class="info-bar">
        <div class="info-item">ğŸ« Ø§Ù„ØµÙ: <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ" style="border:none;outline:none"></div>
        <div class="info-item">ğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø©: <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" style="border:none;outline:none"></div>
      </div>
    </header>

    <div class="toolbar">$1</div>

    <div class="print-header">Ù…Ù„ØªÙ‚Ù‰ Ù…Ø¹Ù„Ù…Ù‰ ÙˆÙ…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>

    <section id="weeks" class="grid"></section>

    <div class="footer-bar">
      <div class="footer-item">ğŸ‘©â€ğŸ« Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…/Ø©: <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…/Ø©" style="border:none;outline:none"></div>
      <div class="footer-item">ğŸ‘¨â€ğŸ’¼ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±/Ø©: <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±/Ø©" style="border:none;outline:none"></div>
    </div>

    <footer class="site-footer">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù…Ù„ØªÙ‚Ù‰ Ù…Ø¹Ù„Ù…Ù‰ ÙˆÙ…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</footer>

    <template id="week-tpl">
      <article class="card" data-week>
        <div class="card-header">
          <span class="badge" data-week-title></span>
          <span class="status" data-status>Ø¬Ø§Ù‡Ø²</span>
        </div>
        <div class="card-body">
          <div class="date-line"><span>Ù…Ù†</span><span class="date-chip" data-range-from></span><span>Ø¥Ù„Ù‰</span><span class="date-chip" data-range-to></span></div>
          <div class="tags" data-tags></div>
          <details class="drawer">
            <summary>Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</summary>
            <div class="drawer-body">
              <div class="day"><label>Ø§Ù„Ø£Ø­Ø¯</label><input placeholder="Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹"><button type="button" class="chip-delete btn" data-clear-day>Ù…Ø³Ø­</button></div>
              <div class="day"><label>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</label><input placeholder="Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹"><button type="button" class="chip-delete btn" data-clear-day>Ù…Ø³Ø­</button></div>
              <div class="day"><label>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</label><input placeholder="Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹"><button type="button" class="chip-delete btn" data-clear-day>Ù…Ø³Ø­</button></div>
              <div class="day"><label>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</label><input placeholder="Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹"><button type="button" class="chip-delete btn" data-clear-day>Ù…Ø³Ø­</button></div>
              <div class="day"><label>Ø§Ù„Ø®Ù…ÙŠØ³</label><input placeholder="Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹"><button type="button" class="chip-delete btn" data-clear-day>Ù…Ø³Ø­</button></div>
            </div>
          </details>
        </div>
        <div class="actions">
          <button type="button" class="btn" data-toggle>Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
          <button type="button" class="btn" data-delete>Ø­Ø°Ù</button>
        </div>
      </article>
    </template>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const weeksEl   = document.getElementById('weeks');
      const printBtn  = document.getElementById('printBtn');
      const undoBtn   = document.getElementById('undoBtn');
      const orientSel = document.getElementById('orientation');

      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® (19 Ø£Ø³Ø¨ÙˆØ¹Ù‹Ø§)
      const weeksData = [
        "24/8 - 28/8", "1/9 - 5/9", "8/9 - 12/9", "15/9 - 19/9", "21/9 - 25/9", "28/9 - 2/10",
        "5/10 - 9/10", "12/10 - 16/10", "19/10 - 23/10", "26/10 - 30/10", "2/11 - 6/11",
        "9/11 - 13/11", "16/11 - 20/11", "23/11 - 27/11", "30/11 - 4/12", "7/12 - 11/12",
        "14/12 - 18/12", "21/12 - 25/12", "28/12 - 1/1"
      ];

      // Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
      const HOLIDAYS = {
        5:  [{type:'holiday', label:'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ (Ù¤ Ø£ÙŠØ§Ù…)'}],
        8:  [{type:'notice',  label:'Ø¥Ø¬Ø§Ø²Ø©'}],
        13: [{type:'notice',  label:'Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ - Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ§Ù… Ø§Ù„Ø®Ù…ÙŠØ³', days:[4]}],
        14: [{type:'break',   label:'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ - Ø£Ø³Ø¨ÙˆØ¹'}],
        16: [{type:'break',   label:'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø´ØªØ§Ø¡ - Ù¡Ù¤ ÙŠÙˆÙ…'}],
        19: [{type:'notice',  label:'Ø¥Ø¬Ø§Ø²Ø© Ù…Ù†ØªØµÙ Ø§Ù„ÙØµÙ„ - ØªØ¨Ø¯Ø£ Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ§Ù… Ø§Ù„Ø®Ù…ÙŠØ³', days:[4]}]
      };

      // Ø£Ø­Ø¯Ø§Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£ÙŠØ§Ù… (Ù„ØªØ¸Ù‡Ø± ÙƒØ­Ø¨Ø© Ù…Ù„ÙˆÙ‘Ù†Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø·Ø±)
      // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø¥Ù…ÙƒØ§Ù†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙŠØ§Ù… Ø­Ø³Ø¨ Ø­Ø§Ø¬ØªÙƒ (0=Ø§Ù„Ø£Ø­Ø¯ .. 4=Ø§Ù„Ø®Ù…ÙŠØ³)
      const EVENTS = {
        1: [{day:0, text:'Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ', type:'success'}],
        5: [{day:1, text:'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ', type:'success'}],
        13:[{day:4, text:'Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ', type:'warn'}],
        15:[{day:4, text:'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', type:'alert'}]
      };

      // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: Ø§ØªØ¬Ø§Ù‡ ÙˆØ£Ø¹Ù…Ø¯Ø©
      function setPrintOrientation(orientation){
        let style = document.getElementById('print-orientation-style');
        if(!style){ style = document.createElement('style'); style.id = 'print-orientation-style'; document.head.appendChild(style); }
        const cols = 5; // Ø«Ø§Ø¨Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© ÙƒØ´Ø¨ÙƒØ© 5x4
        style.textContent = `@page{size: A4 ${orientation}; margin:6mm}`\n@media print{ .grid{grid-template-columns:repeat(${cols},1fr)!important} }`;
      }

      // Ø±Ø³Ù… Ø§Ù„Ø´Ø±Ø§Ø¦Ø· ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
      function applyHolidays(card, num){
        const entries = HOLIDAYS[num];
        const tags = card.querySelector('[data-tags]');
        if(!entries){ return; }
        const from = card.querySelector('[data-range-from]')?.textContent || '';
        const to   = card.querySelector('[data-range-to]')?.textContent || '';
        entries.forEach(ent=>{
          const chip = document.createElement('span');
          chip.className = `chip chip-${ent.type}`;
          chip.textContent = ent.label;
          tags.appendChild(chip);
          if(ent.type){ card.classList.add('card-'+ent.type); }
          if(ent.type==='break'){
            card.classList.add('week-break');
            let bs = card.querySelector('.break-summary');
            if(!bs){
              bs = document.createElement('div');
              bs.className = 'break-summary';
              bs.innerHTML = `
                <div class="row"><span>Ù…Ù†</span><span class="date-chip">${from}</span><span class="small">Ø¥Ø¬Ø§Ø²Ø© Ø±Ø³Ù…ÙŠØ©</span></div>
                <div class="row"><span>Ø¥Ù„Ù‰</span><span class="date-chip">${to}</span><span class="small">Ø¥Ø¬Ø§Ø²Ø© Ø±Ø³Ù…ÙŠØ©</span></div>
              `;
              const body = card.querySelector('.card-body');
              body.appendChild(bs);
            }
          }
          if(ent.days && ent.days.length){
            const dayRows = card.querySelectorAll('.day');
            ent.days.forEach(idx=>{
              const row = dayRows[idx];
              if(row){
                row.classList.add('is-holiday');
                const inp = row.querySelector('input');
                if(inp && !inp.value) inp.placeholder = 'Ø¥Ø¬Ø§Ø²Ø©';
              }
            });
          }
        });
      }

      function applyEvents(card, num){
        if(card.classList.contains('week-break')) return; // Ù„Ø§ Ù†ÙƒØ±Ø± Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙÙŠ Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        const entries = EVENTS[num];
        if(!entries) return;
        const dayRows = card.querySelectorAll('.day');
        entries.forEach(e=>{
          const row = dayRows[e.day];
          if(!row) return;
          row.dataset.event = e.text; // Ù„Ø¥Ø¸Ù‡Ø§Ø±Ù‡Ø§ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¹Ù†Ø¯ Ø®Ù„Ùˆ Ø§Ù„Ø­Ù‚Ù„
          const pill = document.createElement('span');
          pill.className = `pill ${e.type==='success'?'pill-success':e.type==='warn'?'pill-warn':'pill-alert'}`;
          pill.textContent = e.text;
          row.appendChild(pill);
        });
      }


      // Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ (Ù„Ø²Ø± Ø§Ù„ØªØ±Ø§Ø¬Ø¹)
      let historyStack = [];
      const saveSnapshot = () => { historyStack.push(weeksEl.innerHTML); if(historyStack.length>5) historyStack.shift(); };

      function renderWeeks(){
        weeksEl.innerHTML='';
        for(let i=1; i<=19; i++){
          const tpl  = document.getElementById('week-tpl').content.cloneNode(true);
          const node = tpl.firstElementChild;
          node.querySelector('[data-week-title]').textContent = `Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i}`;
          const dr = (weeksData[i-1]||'').split(' - ');
          node.querySelector('[data-range-from]').textContent = dr[0]||'';
          node.querySelector('[data-range-to]').textContent   = dr[1]||'';
          weeksEl.appendChild(node);
          applyHolidays(node, i);
          applyEvents(node, i);
        }
        saveSnapshot();
      }
      renderWeeks();

      // Ø£Ø­Ø¯Ø§Ø« ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
      weeksEl.addEventListener('click', (e)=>{
        const btn  = e.target.closest('button');
        if(!btn) return;
        const card = e.target.closest('[data-week]');
        if(!card) return;
        if(btn.matches('[data-toggle]')){
          e.preventDefault();
          card.querySelector('details').open = !card.querySelector('details').open;
        } else if(btn.matches('[data-delete]')){
          e.preventDefault(); saveSnapshot(); if(confirm('Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©ØŸ')) card.remove();
        } else if(btn.matches('[data-clear-day]')){
          e.preventDefault(); const input = btn.closest('.day').querySelector('input'); if(input) input.value='';
        }
      });

      // Ø·Ø¨Ø§Ø¹Ø©
      if(orientSel){
        setPrintOrientation(orientSel.value);
        orientSel.addEventListener('change', ()=> setPrintOrientation(orientSel.value));
      }
      printBtn && printBtn.addEventListener('click', (ev)=>{
        ev.preventDefault(); ev.stopPropagation();
        setPrintOrientation(orientSel ? orientSel.value : 'portrait');
        setTimeout(()=>{ try{ window.focus(); window.print(); }catch(_){} }, 0);
      });

      // ØªØ±Ø§Ø¬Ø¹
      undoBtn && undoBtn.addEventListener('click', (ev)=>{
        ev.preventDefault();
        if(historyStack.length){ weeksEl.innerHTML = historyStack.pop(); }
      });

      // Ø§ÙØªØ­ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ø¸Ù‡Ø± Ù‚ÙŠÙ… Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©ØŒ Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
      const prevStates = new Map();
      window.addEventListener('beforeprint', ()=>{
        document.querySelectorAll('details.drawer').forEach(d=>{ prevStates.set(d, d.open); d.open = true; });
        document.querySelectorAll('.day').forEach(row=>{
          const inp = row.querySelector('input');
          if(!inp) return;
          let pv = row.querySelector('.print-value');
          if(!pv){
            pv = document.createElement('div');
            pv.className = 'print-value';
            const del = row.querySelector('.chip-delete');
            if(del){ row.insertBefore(pv, del); } else { row.appendChild(pv); }
          }
          pv.textContent = (inp.value && inp.value.trim()) ? inp.value : (row.dataset.event || '');
        });
      });
      window.addEventListener('afterprint', ()=>{
        prevStates.forEach((wasOpen,d)=>{ d.open = wasOpen; });
        prevStates.clear();
      });

      // Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø³ÙŠØ·Ø© (Smoke Tests)
      console.assert(document.getElementById('week-tpl'), 'template Ù…ÙˆØ¬ÙˆØ¯');
      console.assert(weeksEl.children.length === 19, 'ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ 19 Ø£Ø³Ø¨ÙˆØ¹Ù‹Ø§');
      console.assert(document.getElementById('print-orientation-style') || true, 'Ø³ÙŠÙÙ†Ø´Ø£ Ù†Ù…Ø· Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø·Ø¨Ø§Ø¹Ø©/ØªØºÙŠÙŠØ±');
    });
  </script>
</body>
</html>
